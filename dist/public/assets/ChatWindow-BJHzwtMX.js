import{t as s,r as t,a as c,j as e,C as g,B as h,X as U,I as p}from"./index-C8m1bZGW.js";import{M as b,A as T,B as C}from"./popover-BpxRwVL7.js";import{S as w}from"./scroll-area-ByH8-GEw.js";import{I as L}from"./image-B3LqO_1i.js";import{S as P}from"./send-DAm2XOIU.js";function B({conversationId:y,petId:W}){const{data:M}=s.auth.me.useQuery(),N=s.useUtils(),l=t.useRef(null),[i,S]=t.useState(y||null),[n,v]=t.useState(""),[a,u]=t.useState(null),{data:d}=s.chat.getConversations.useQuery(),{data:m}=s.chat.getMessages.useQuery({conversationId:i},{enabled:!!i,refetchInterval:3e3}),x=s.chat.sendMessage.useMutation({onSuccess:()=>{N.chat.getMessages.invalidate({conversationId:i}),N.chat.getConversations.invalidate(),v(""),u(null),D()},onError:r=>{c.error(`Erro ao enviar mensagem: ${r.message}`)}}),D=()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)};t.useEffect(()=>{D()},[m]);const j=r=>{const o=r.target.files?.[0];if(o){if(o.size>10*1024*1024){c.error("Arquivo muito grande. Máximo 10MB");return}u(o)}},f=async()=>{if(!n.trim()&&!a){c.error("Digite uma mensagem ou selecione um arquivo");return}if(!i){c.error("Selecione uma conversa");return}let r;if(a){const o=new FileReader;r=await new Promise(E=>{o.onloadend=()=>E(o.result),o.readAsDataURL(a)})}await x.mutateAsync({conversationId:i,content:n||void 0,mediaData:r,messageType:a?a.type.startsWith("image/")?"image":"video":"text"})};return e.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-12rem)]",children:[e.jsxDEV(g,{className:"p-4 overflow-hidden flex flex-col",children:[e.jsxDEV("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsxDEV(b,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:101,columnNumber:11},this),"Conversas"]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:100,columnNumber:9},this),e.jsxDEV(w,{className:"flex-1",children:e.jsxDEV("div",{className:"space-y-2",children:[d&&d.length===0&&e.jsxDEV("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Nenhuma conversa ainda"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:108,columnNumber:15},this),d?.map(r=>e.jsxDEV(g,{className:`p-3 cursor-pointer hover:bg-accent transition-colors ${i===r.id?"bg-accent":""}`,onClick:()=>S(r.id),children:e.jsxDEV("div",{className:"flex items-start gap-3",children:[e.jsxDEV(T,{className:"h-10 w-10 bg-orange-100 flex items-center justify-center",children:e.jsxDEV("span",{className:"text-orange-600 font-semibold",children:r.participantName?.charAt(0)||"U"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:123,columnNumber:21},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:122,columnNumber:19},this),e.jsxDEV("div",{className:"flex-1 min-w-0",children:[e.jsxDEV("div",{className:"flex items-center justify-between gap-2",children:[e.jsxDEV("p",{className:"font-semibold text-sm truncate",children:r.participantName},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:129,columnNumber:23},this),r.unreadCount>0&&e.jsxDEV(C,{variant:"destructive",className:"h-5 w-5 p-0 flex items-center justify-center text-xs",children:r.unreadCount},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:131,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:128,columnNumber:21},this),r.petName&&e.jsxDEV(C,{variant:"secondary",className:"text-xs mt-1",children:r.petName},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:137,columnNumber:23},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground truncate mt-1",children:r.lastMessage||"Nenhuma mensagem"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:139,columnNumber:21},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground mt-1",children:r.lastMessageAt&&new Date(r.lastMessageAt).toLocaleString("pt-BR")},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:142,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:127,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:121,columnNumber:17},this)},r.id,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:114,columnNumber:15},this))]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:106,columnNumber:11},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:105,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:99,columnNumber:7},this),e.jsxDEV(g,{className:"lg:col-span-2 p-4 overflow-hidden flex flex-col",children:i?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(w,{className:"flex-1 pr-4",ref:l,children:e.jsxDEV("div",{className:"space-y-4",children:[m&&m.length===0&&e.jsxDEV("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Nenhuma mensagem ainda. Envie a primeira!"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:168,columnNumber:19},this),m?.map(r=>{const o=r.senderId===M?.id;return e.jsxDEV("div",{className:`flex gap-3 ${o?"flex-row-reverse":""}`,children:[e.jsxDEV(T,{className:`h-8 w-8 ${o?"bg-orange-100":"bg-gray-100"} flex items-center justify-center flex-shrink-0`,children:e.jsxDEV("span",{className:`${o?"text-orange-600":"text-gray-600"} text-sm font-semibold`,children:r.senderName?.charAt(0)||"U"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:181,columnNumber:25},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:180,columnNumber:23},this),e.jsxDEV("div",{className:`flex flex-col ${o?"items-end":"items-start"} max-w-[70%]`,children:[e.jsxDEV("div",{className:`rounded-lg p-3 ${o?"bg-orange-500 text-white":"bg-gray-100"} relative`,children:[r.source==="whatsapp"&&e.jsxDEV("div",{className:"absolute -top-2 -right-2 bg-green-500 rounded-full p-1",children:e.jsxDEV(b,{className:"h-3 w-3 text-white"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:190,columnNumber:31},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:189,columnNumber:29},this),r.message&&e.jsxDEV("p",{className:"text-sm whitespace-pre-wrap",children:r.message},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:194,columnNumber:29},this),r.mediaUrl&&e.jsxDEV("img",{src:r.mediaUrl,alt:"Media",className:"mt-2 rounded max-w-full"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:197,columnNumber:29},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:187,columnNumber:25},this),e.jsxDEV("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:new Date(r.createdAt).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:205,columnNumber:27},this),r.source==="whatsapp"&&e.jsxDEV(C,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 bg-green-50 text-green-700 border-green-200",children:"WhatsApp"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:212,columnNumber:29},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:204,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:186,columnNumber:23},this)]},r.id,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:176,columnNumber:21},this)})]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:166,columnNumber:15},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:165,columnNumber:13},this),e.jsxDEV("div",{className:"mt-4 space-y-2",children:[a&&e.jsxDEV("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded",children:[e.jsxDEV("span",{className:"text-sm flex-1 truncate",children:a.name},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:228,columnNumber:19},this),e.jsxDEV(h,{variant:"ghost",size:"sm",onClick:()=>u(null),children:e.jsxDEV(U,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:234,columnNumber:21},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:229,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:227,columnNumber:17},this),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(p,{type:"file",accept:"image/*,video/*",className:"hidden",id:"chat-media",onChange:j},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:240,columnNumber:17},this),e.jsxDEV("label",{htmlFor:"chat-media",children:e.jsxDEV(h,{variant:"outline",size:"icon",asChild:!0,children:e.jsxDEV("span",{className:"cursor-pointer",children:e.jsxDEV(L,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:250,columnNumber:23},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:249,columnNumber:21},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:248,columnNumber:19},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:247,columnNumber:17},this),e.jsxDEV(p,{placeholder:"Digite sua mensagem...",value:n,onChange:r=>v(r.target.value),onKeyPress:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),f())},className:"flex-1"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:255,columnNumber:17},this),e.jsxDEV(h,{onClick:f,disabled:x.isPending,children:e.jsxDEV(P,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:272,columnNumber:19},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:268,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:239,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:225,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:163,columnNumber:11},this):e.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV(b,{className:"h-16 w-16 mx-auto mb-4 opacity-50"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:158,columnNumber:15},this),e.jsxDEV("p",{children:"Selecione uma conversa para começar"},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:159,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:157,columnNumber:13},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:156,columnNumber:11},this)},void 0,!1,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:154,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/rodrigorochameire/Library/CloudStorage/GoogleDrive-rodrigorochameire@gmail.com/Meu Drive/Pessoal/Tuco Care/TeteCareHub/client/src/components/ChatWindow.tsx",lineNumber:97,columnNumber:5},this)}export{B as C};
